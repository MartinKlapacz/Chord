syntax = "proto3";

package chord;

message Empty {
}

message AddressMsg {
  string address = 1;
}

message KeyMsg {
  bytes key = 1;
}

message FingerTableMsg {
  repeated AddressMsg fingers = 1;
}

message FingerEntryMsg {
  bytes id = 1;
  string address = 2;
}

message FingerEntryDebugMsg {
  string id = 1;
  string address = 2;
}

message NodeSummaryMsg {
  string url = 1;
  string id = 2;
  FingerEntryDebugMsg predecessor = 3;
  repeated FingerEntryDebugMsg fingerEntries = 4;
}

message Data {
  // todo
}

message UpdateFingerTableEntryRequest {
  uint32 index = 1;
  FingerEntryMsg fingerEntry = 2;
}


service Chord {
  rpc FindSuccessor (KeyMsg) returns (AddressMsg);
  rpc FindPredecessor (KeyMsg) returns (AddressMsg);
  rpc GetPredecessor (Empty) returns (AddressMsg);
  rpc SetPredecessor (AddressMsg) returns (Data);
  rpc UpdateFingerTableEntry (UpdateFingerTableEntryRequest) returns (Empty);

  // debug
  rpc GetNodeSummary (Empty) returns (NodeSummaryMsg);
}
